<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>网球记分牌</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="网球记分牌" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      background-color: #ffffff;
      color: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 16px;
    }

    body.fullscreen-mode {
      align-items: stretch;
      justify-content: stretch;
      padding: 0;
    }

    body.ios-virtual-landscape {
      padding: 0;
      margin: 0;
      background-color: #000000;
      overflow: hidden;
    }

    .scoreboard-container {
      width: min(480px, 100vw - 32px);
      background: #ffffff;
      border-radius: 24px;
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.12),
        0 1px 3px rgba(15, 23, 42, 0.08);
      padding: 24px 20px 20px;
    }

    .scoreboard-container.fullscreen {
      width: 100vw;
      height: 100vh;
      max-width: 100vw;
      max-height: 100vh;
      border-radius: 0;
      box-shadow: none;
      padding: 12px 20px 16px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
    }

    .scoreboard-container.virtual-landscape {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 100vh;
      height: 100vw;
      max-width: 100vh;
      max-height: 100vw;
      transform: translate(-50%, -50%) rotate(90deg);
      border-radius: 0;
      box-shadow: none;
      padding: 12px 20px 16px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background-color: #ffffff;
    }

    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
    }

    .title {
      text-align: center;
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.02em;
      margin-bottom: 4px;
    }

    .subtitle {
      text-align: left;
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 12px;
    }

    .mode-switch {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 4px;
      border-radius: 999px;
      background: #f3f4f6;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.9);
      margin-bottom: 16px;
    }

    .mode-btn {
      border: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      background: transparent;
      color: #6b7280;
      transition:
        background-color 0.16s ease-out,
        color 0.16s ease-out,
        transform 0.12s ease-out;
      -webkit-tap-highlight-color: transparent;
      white-space: nowrap;
    }

    .mode-btn.active {
      background: #ffffff;
      color: #111827;
      box-shadow:
        0 1px 2px rgba(15, 23, 42, 0.10),
        0 0 0 1px rgba(209, 213, 219, 0.8);
      transform: translateY(-0.5px);
    }

    .icon-btn {
      border: none;
      background: transparent;
      width: 32px;
      height: 32px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      color: #6b7280;
      transition:
        background-color 0.16s ease-out,
        color 0.16s ease-out,
        transform 0.12s ease-out;
      -webkit-tap-highlight-color: transparent;
    }

    .icon-btn:hover {
      background-color: #f3f4f6;
      color: #111827;
    }

    .icon-btn:active {
      transform: scale(0.92);
      background-color: #e5e7eb;
    }

    .scores-row {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .team {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      touch-action: manipulation;
    }

    .team-label {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .team-label.red {
      color: #dc2626;
    }

    .team-label.blue {
      color: #2563eb;
    }

    .score {
      font-variant-numeric: tabular-nums;
      font-size: clamp(40px, 10vw, 56px);
      font-weight: 800;
      line-height: 1;
      padding: 14px 18px;
      border-radius: 18px;
      min-width: 96px;
      text-align: center;
      background: radial-gradient(circle at top, #f9fafb 0, #e5e7eb 50%, #d1d5db 100%);
      box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.8),
        0 10px 20px rgba(15, 23, 42, 0.16);
    }

    .score.red {
      color: #dc2626;
    }

    .score.blue {
      color: #2563eb;
    }

    .vs {
      font-size: 16px;
      font-weight: 600;
      color: #9ca3af;
      padding: 4px 8px;
      border-radius: 999px;
      background: #f3f4f6;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.9);
    }

    .buttons-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .btn {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 10px 12px;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      cursor: pointer;
      outline: none;
      background: #e5e7eb;
      color: #111827;
      box-shadow:
        0 10px 20px rgba(15, 23, 42, 0.18),
        0 1px 2px rgba(15, 23, 42, 0.2);
      transition:
        transform 0.12s ease-out,
        box-shadow 0.12s ease-out,
        background-color 0.16s ease-out,
        filter 0.16s ease-out;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .btn:active {
      transform: translateY(1px) scale(0.97);
      box-shadow:
        0 4px 10px rgba(15, 23, 42, 0.18),
        0 0 0 rgba(15, 23, 42, 0.2);
      filter: brightness(0.98);
    }

    .btn::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: radial-gradient(circle at 50% 0%, rgba(255,255,255,0.65), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }

    .btn-primary-red {
      background: linear-gradient(135deg, #f97373, #dc2626);
      color: #ffffff;
    }

    .btn-primary-blue {
      background: linear-gradient(135deg, #60a5fa, #2563eb);
      color: #ffffff;
    }

    .btn-secondary {
      background: linear-gradient(135deg, #e5e7eb, #d1d5db);
      color: #111827;
    }

    .btn-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.75);
      color: inherit;
      font-size: 13px;
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.4);
    }

    .btn-label {
      white-space: nowrap;
    }

    .bottom-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-top: 6px;
    }

    .status-text {
      font-size: 12px;
      color: #6b7280;
      display: flex;
      align-items: center;
      gap: 6px;
      min-height: 1.4em;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #10b981;
      box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.16);
    }

    .btn-small {
      padding: 8px 12px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.03em;
      min-width: 90px;
    }

    .btn-disabled,
    .btn:disabled {
      cursor: default;
      opacity: 0.6;
      box-shadow:
        0 4px 10px rgba(15, 23, 42, 0.12),
        0 0 0 rgba(15, 23, 42, 0.2);
    }

    .btn:disabled:active {
      transform: none;
      filter: none;
    }

    .btn-pulse {
      animation: btnPulse 0.18s ease-out;
    }

    @keyframes btnPulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(0.95);
      }
      100% {
        transform: scale(1);
      }
    }

    @media (max-width: 420px) {
      .scoreboard-container {
        padding: 20px 16px 16px;
      }

      .score {
        min-width: 80px;
        padding: 10px 12px;
      }
    }

    /* 全屏/横屏纯净版样式 */
    .scoreboard-container.fullscreen .title,
    .scoreboard-container.virtual-landscape .title,
    .scoreboard-container.fullscreen .subtitle,
    .scoreboard-container.virtual-landscape .subtitle {
      display: none;
    }

    .scoreboard-container.fullscreen .mode-switch,
    .scoreboard-container.virtual-landscape .mode-switch {
      display: none;
    }

    /* 全屏模式下，退出全屏按钮需要显示，但标题隐藏 */
    .scoreboard-container.fullscreen .header-row,
    .scoreboard-container.virtual-landscape .header-row {
      position: absolute;
      top: 8px;
      right: 8px;
      left: auto;
      width: auto;
      margin-bottom: 0;
      justify-content: flex-end;
    }

    .scoreboard-container.fullscreen .scores-row,
    .scoreboard-container.virtual-landscape .scores-row {
      margin-bottom: 12px;
      align-items: center;
      flex: 1;
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 12px;
      justify-content: center;
      min-height: 0;
    }

    .scoreboard-container.fullscreen .team,
    .scoreboard-container.virtual-landscape .team {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 0;
    }

    .scoreboard-container.fullscreen .team-label,
    .scoreboard-container.virtual-landscape .team-label {
      font-size: clamp(18px, 4vw, 24px);
      margin-bottom: 8px;
    }

    .scoreboard-container.fullscreen .score,
    .scoreboard-container.virtual-landscape .score {
      font-size: clamp(80px, 20vw, 160px);
      min-width: 0;
      padding: 20px 16px;
      background: none;
      box-shadow: none;
      width: 100%;
      max-width: 100%;
    }

    .scoreboard-container.fullscreen .vs,
    .scoreboard-container.virtual-landscape .vs {
      font-size: clamp(20px, 4vw, 28px);
      padding: 8px 12px;
      margin: 0 12px;
    }

    .scoreboard-container.fullscreen .buttons-row,
    .scoreboard-container.virtual-landscape .buttons-row {
      margin-bottom: 12px;
      gap: 12px;
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      justify-items: center;
    }

    .scoreboard-container.fullscreen .buttons-row .btn-primary-red,
    .scoreboard-container.virtual-landscape .buttons-row .btn-primary-red {
      grid-column: 1;
      justify-self: center;
    }

    .scoreboard-container.fullscreen .buttons-row .btn-primary-blue,
    .scoreboard-container.virtual-landscape .buttons-row .btn-primary-blue {
      grid-column: 3;
      justify-self: center;
    }

    .scoreboard-container.fullscreen .btn-primary-red,
    .scoreboard-container.virtual-landscape .btn-primary-red,
    .scoreboard-container.fullscreen .btn-primary-blue,
    .scoreboard-container.virtual-landscape .btn-primary-blue {
      max-width: 140px;
      padding: 8px 10px;
      font-size: 12px;
      box-shadow:
        0 6px 12px rgba(15, 23, 42, 0.16),
        0 1px 1px rgba(15, 23, 42, 0.2);
    }

    .scoreboard-container.fullscreen .btn-icon,
    .scoreboard-container.virtual-landscape .btn-icon {
      width: 16px;
      height: 16px;
      font-size: 11px;
    }

    .scoreboard-container.fullscreen .bottom-row,
    .scoreboard-container.virtual-landscape .bottom-row {
      margin-top: auto;
      padding-top: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }

    .scoreboard-container.fullscreen .status-text,
    .scoreboard-container.virtual-landscape .status-text {
      font-size: 12px;
    }

    .scoreboard-container.fullscreen .btn-small,
    .scoreboard-container.virtual-landscape .btn-small {
      display: inline-flex;
    }
  </style>
</head>
<body>
  <div class="scoreboard-container" id="scoreboard-root">
    <div class="header-row">
      <div class="title">网球记分牌</div>
      <button id="btn-toggle-fullscreen" class="icon-btn" type="button" aria-label="切换全屏">
        ⛶
      </button>
    </div>
    <div class="subtitle">红蓝双方比分清晰展示，支持撤销、快速清空与全屏横屏模式</div>

    <div class="mode-switch" aria-label="计分模式选择">
      <button id="mode-normal" class="mode-btn active" type="button">普通模式</button>
      <button id="mode-tennis" class="mode-btn" type="button">发球局模式</button>
    </div>

    <div class="scores-row">
      <div class="team" id="touch-red-area">
        <div class="team-label red">红方</div>
        <div id="score-red" class="score red">0</div>
      </div>

      <div class="vs">VS</div>

      <div class="team" id="touch-blue-area">
        <div class="team-label blue">蓝方</div>
        <div id="score-blue" class="score blue">0</div>
      </div>
    </div>

    <div class="buttons-row">
      <button id="btn-red-plus" class="btn btn-primary-red" type="button">
        <span class="btn-icon">＋</span>
        <span class="btn-label">红方加一分</span>
      </button>
      <button id="btn-blue-plus" class="btn btn-primary-blue" type="button">
        <span class="btn-icon">＋</span>
        <span class="btn-label">蓝方加一分</span>
      </button>
    </div>

    <div class="bottom-row">
      <div class="status-text" id="status-text">
        <span class="status-dot"></span>
        <span>已就绪，开始一场新的比赛吧。</span>
      </div>
      <div style="display:flex; gap:8px;">
        <button id="btn-undo" class="btn btn-secondary btn-small btn-disabled" type="button" disabled>
          撤销
        </button>
        <button id="btn-reset" class="btn btn-secondary btn-small" type="button">
          清空
        </button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const MAX_SCORE = 99;
      const MODE_NORMAL = "normal";
      const MODE_TENNIS = "tennis";
      const SWIPE_THRESHOLD = 40; // 像素，向上滑动超过该值才算有效

      const scoreRedEl = document.getElementById("score-red");
      const scoreBlueEl = document.getElementById("score-blue");
      const btnRedPlus = document.getElementById("btn-red-plus");
      const btnBluePlus = document.getElementById("btn-blue-plus");
      const btnUndo = document.getElementById("btn-undo");
      const btnReset = document.getElementById("btn-reset");
      const statusText = document.getElementById("status-text");
      const btnToggleFullscreen = document.getElementById("btn-toggle-fullscreen");
      const scoreboardRoot = document.getElementById("scoreboard-root");
      const modeNormalBtn = document.getElementById("mode-normal");
      const modeTennisBtn = document.getElementById("mode-tennis");
      const redPlusLabel = btnRedPlus ? btnRedPlus.querySelector(".btn-label") : null;
      const bluePlusLabel = btnBluePlus ? btnBluePlus.querySelector(".btn-label") : null;
      const touchRedArea = document.getElementById("touch-red-area");
      const touchBlueArea = document.getElementById("touch-blue-area");

      let state = {
        mode: MODE_NORMAL,
        red: 0,
        blue: 0,
        tennisRed: "0",
        tennisBlue: "0",
      };

      let isFullscreen = false;
      const swipeStartY = {
        red: null,
        blue: null,
      };

      /**
       * history 栈，用于撤销：
       * 每次操作前把当前比分入栈，
       * 撤销时恢复上一状态。
       */
      const historyStack = [];

      function updateView(message) {
        if (state.mode === MODE_TENNIS) {
          scoreRedEl.textContent = state.tennisRed;
          scoreBlueEl.textContent = state.tennisBlue;
        } else {
          scoreRedEl.textContent = state.red;
          scoreBlueEl.textContent = state.blue;
        }

        // 控制撤销按钮状态
        if (historyStack.length === 0) {
          btnUndo.classList.add("btn-disabled");
          btnUndo.disabled = true;
        } else {
          btnUndo.classList.remove("btn-disabled");
          btnUndo.disabled = false;
        }

        if (typeof message === "string" && message.trim() !== "") {
          statusText.innerHTML =
            '<span class="status-dot"></span>' +
            "<span>" +
            message +
            "</span>";
        }
      }

      function pushHistory() {
        historyStack.push({ ...state });
      }

      async function enterFullscreenMode() {
        isFullscreen = true;
        const ua = window.navigator.userAgent || "";
        const isIOS = /iPhone|iPad|iPod/.test(ua) && !window.MSStream;
        const isStandalone = window.navigator.standalone === true;

        // iOS Safari（非添加到主屏幕）无法真正隐藏标签栏，这里使用“虚拟横屏”，让内容横过来并尽量占满屏幕
        if (isIOS && !isStandalone) {
          document.body.classList.add("ios-virtual-landscape");
          if (scoreboardRoot) {
            scoreboardRoot.classList.add("virtual-landscape");
          }
          // 尝试滚动到顶部，避免看到地址栏
          window.scrollTo(0, 0);
        } else {
          document.body.classList.add("fullscreen-mode");
          if (scoreboardRoot) {
            scoreboardRoot.classList.add("fullscreen");
          }

          // 非 iOS 或 PWA 场景下，尽量请求浏览器全屏，并锁定横屏
          const root = document.documentElement;
          if (root.requestFullscreen) {
            try {
              await root.requestFullscreen();
            } catch (e) {
              // 某些浏览器可能不允许或需要额外权限，静默失败即可
            }
          }

          if (screen.orientation && screen.orientation.lock) {
            try {
              await screen.orientation.lock("landscape");
            } catch (e) {
              // 不支持则忽略
            }
          }
        }

        if (btnToggleFullscreen) {
          btnToggleFullscreen.textContent = "↩";
        }

        updateView(isIOS && !isStandalone
          ? "已进入横屏显示模式（iPhone 浏览器受系统限制，建议添加到主屏幕获得真正全屏）。"
          : "已进入全屏模式（建议横屏握持设备）。"
        );
      }

      async function exitFullscreenMode() {
        isFullscreen = false;
        document.body.classList.remove("fullscreen-mode", "ios-virtual-landscape");
        if (scoreboardRoot) {
          scoreboardRoot.classList.remove("fullscreen", "virtual-landscape");
        }

        if (document.fullscreenElement && document.exitFullscreen) {
          try {
            await document.exitFullscreen();
          } catch (e) {
            // 忽略退出失败
          }
        }

        if (btnToggleFullscreen) {
          btnToggleFullscreen.textContent = "⛶";
        }

        updateView("已退出全屏模式。");
      }

      function animateButton(btn) {
        btn.classList.remove("btn-pulse");
        // 强制重绘以重新触发动画
        // eslint-disable-next-line no-unused-expressions
        void btn.offsetWidth;
        btn.classList.add("btn-pulse");
      }

      function addTennisPoint(team) {
        const scoringKey = team === "red" ? "tennisRed" : "tennisBlue";
        const oppKey = team === "red" ? "tennisBlue" : "tennisRed";

        let s = state[scoringKey];
        let o = state[oppKey];

        // 若一方已赢下本局，则提示先清空
        if (s === "WIN" || o === "WIN") {
          updateView("本局已结束，请先清空比分开始新的一局。");
          return;
        }

        // 当前方已占先，再赢一分直接赢下本局
        if (s === "AD") {
          state[scoringKey] = "WIN";
          updateView(team === "red" ? "红方赢下本局！" : "蓝方赢下本局！");
          return;
        }

        // 对手占先，自己得分则回到 40:40
        if (s === "40" && o === "AD") {
          state[oppKey] = "40";
          updateView(team === "red" ? "红方得分，比分回到 40:40。" : "蓝方得分，比分回到 40:40。");
          return;
        }

        // 自己 40，对手小于 40，赢下本局
        if (s === "40" && (o === "0" || o === "15" || o === "30")) {
          state[scoringKey] = "WIN";
          updateView(team === "red" ? "红方赢下本局！" : "蓝方赢下本局！");
          return;
        }

        // 双方 40，自家变为占先 AD
        if (s === "40" && o === "40") {
          state[scoringKey] = "AD";
          updateView(team === "red" ? "红方占先（AD）。" : "蓝方占先（AD）。");
          return;
        }

        // 普通加分：0 -> 15 -> 30 -> 40
        if (s === "0") {
          state[scoringKey] = "15";
        } else if (s === "15") {
          state[scoringKey] = "30";
        } else if (s === "30") {
          state[scoringKey] = "40";
        }

        updateView(team === "red" ? "红方赢下一分。" : "蓝方赢下一分。");
      }

      function syncModeButtonsAndLabels() {
        if (modeNormalBtn && modeTennisBtn) {
          modeNormalBtn.classList.toggle("active", state.mode === MODE_NORMAL);
          modeTennisBtn.classList.toggle("active", state.mode === MODE_TENNIS);
        }
        if (redPlusLabel && bluePlusLabel) {
          if (state.mode === MODE_TENNIS) {
            redPlusLabel.textContent = "红方赢一分";
            bluePlusLabel.textContent = "蓝方赢一分";
          } else {
            redPlusLabel.textContent = "红方加一分";
            bluePlusLabel.textContent = "蓝方加一分";
          }
        }
      }

      function switchMode(nextMode) {
        if (state.mode === nextMode) return;

        state.mode = nextMode;
        // 切换模式时清空历史栈，避免跨模式撤销造成混乱
        historyStack.length = 0;

        if (nextMode === MODE_TENNIS) {
          state.tennisRed = "0";
          state.tennisBlue = "0";
          updateView("已切换到发球局模式，比分重置为 0:0。");
        } else {
          state.red = 0;
          state.blue = 0;
          updateView("已切换到普通模式，比分重置为 0:0。");
        }

        syncModeButtonsAndLabels();
      }

      function addPoint(team) {
        pushHistory();

        if (state.mode === MODE_TENNIS) {
          addTennisPoint(team);
          return;
        }

        if (team === "red") {
          state.red = Math.min(MAX_SCORE, state.red + 1);
        } else if (team === "blue") {
          state.blue = Math.min(MAX_SCORE, state.blue + 1);
        }

        const message =
          team === "red"
            ? "红方加一分。"
            : "蓝方加一分。";

        updateView(message);
      }

      function undoLast() {
        if (historyStack.length === 0) return;

        const prev = historyStack.pop();
        state = { ...prev };

        updateView("已撤销上一步操作。");
      }

      function resetScores() {
        // 只有在当前比分不是 0:0 时才入栈
        if (state.mode === MODE_TENNIS) {
          if (state.tennisRed !== "0" || state.tennisBlue !== "0") {
            pushHistory();
          }
          state.tennisRed = "0";
          state.tennisBlue = "0";
        } else {
          if (state.red !== 0 || state.blue !== 0) {
            pushHistory();
          }
          state.red = 0;
          state.blue = 0;
        }
        updateView("比分已清空，重新开始。");
      }

      btnRedPlus.addEventListener("click", function () {
        if (state.mode === MODE_NORMAL && state.red >= MAX_SCORE) {
          updateView("红方已经达到最大分数 99。");
          animateButton(btnRedPlus);
          return;
        }
        addPoint("red");
        animateButton(btnRedPlus);
      });

      btnBluePlus.addEventListener("click", function () {
        if (state.mode === MODE_NORMAL && state.blue >= MAX_SCORE) {
          updateView("蓝方已经达到最大分数 99。");
          animateButton(btnBluePlus);
          return;
        }
        addPoint("blue");
        animateButton(btnBluePlus);
      });

      btnUndo.addEventListener("click", function () {
        if (historyStack.length === 0) return;
        undoLast();
        animateButton(btnUndo);
      });

      btnReset.addEventListener("click", function () {
        resetScores();
        animateButton(btnReset);
      });

      function bindSwipeArea(el, teamKey) {
        if (!el) return;

        el.addEventListener("touchstart", function (e) {
          if (!e.touches || e.touches.length === 0) return;
          swipeStartY[teamKey] = e.touches[0].clientY;
        }, { passive: true });

        el.addEventListener("touchend", function (e) {
          if (swipeStartY[teamKey] == null || !e.changedTouches || e.changedTouches.length === 0) return;
          const endY = e.changedTouches[0].clientY;
          const deltaY = swipeStartY[teamKey] - endY;
          swipeStartY[teamKey] = null;

          if (deltaY > SWIPE_THRESHOLD) {
            // 向上滑动，视为赢下一球
            addPoint(teamKey === "red" ? "red" : "blue");
            if (teamKey === "red" && btnRedPlus) {
              animateButton(btnRedPlus);
            } else if (teamKey === "blue" && btnBluePlus) {
              animateButton(btnBluePlus);
            }
          }
        }, { passive: true });
      }

      bindSwipeArea(touchRedArea, "red");
      bindSwipeArea(touchBlueArea, "blue");

      if (modeNormalBtn && modeTennisBtn) {
        modeNormalBtn.addEventListener("click", function () {
          switchMode(MODE_NORMAL);
          animateButton(modeNormalBtn);
        });
        modeTennisBtn.addEventListener("click", function () {
          switchMode(MODE_TENNIS);
          animateButton(modeTennisBtn);
        });
      }

      if (btnToggleFullscreen) {
        btnToggleFullscreen.addEventListener("click", function () {
          if (isFullscreen) {
            exitFullscreenMode();
          } else {
            enterFullscreenMode();
          }
          animateButton(btnToggleFullscreen);
        });
      }

      // 当用户通过系统的“退出全屏”按钮离开全屏时，保持状态同步
      document.addEventListener("fullscreenchange", function () {
        const nowFullscreen = !!document.fullscreenElement;
        if (!nowFullscreen && isFullscreen) {
          isFullscreen = false;
          document.body.classList.remove("fullscreen-mode", "ios-virtual-landscape");
          if (scoreboardRoot) {
            scoreboardRoot.classList.remove("fullscreen", "virtual-landscape");
          }
          if (btnToggleFullscreen) {
            btnToggleFullscreen.textContent = "⛶";
          }
        }
      });

      // 初始化界面
      updateView();
      syncModeButtonsAndLabels();
    })();
  </script>
</body>
</html>


